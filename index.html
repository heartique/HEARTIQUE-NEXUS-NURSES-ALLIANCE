<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ğŸŒ— Theme Setup -->
  <script>
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const theme = savedTheme || (prefersDark ? "dark" : "light");
    document.documentElement.setAttribute("data-theme", theme);
  </script>

  <!-- âœ… Meta Setup -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- ğŸ” SEO -->
  <title>Heartique Nexus Dashboard</title>
  <meta name="description" content="The ultimate dashboard for Heartique Nursing Nexus â€“ study tools, updates, and essential nursing resources.">
  <meta name="keywords" content="nursing, notes, dashboard, CHK, Heartique nursing nexus alliance, study, PTS, Kenya">
  <meta name="author" content="Heartique Nursing Nexus Team">
  <meta name="robots" content="index, follow">

  <!-- ğŸŒ Open Graph for Sharing -->
  <meta property="og:title" content="Heartique Nursing Nexus Dashboard">
  <meta property="og:description" content="Your go-to platform for nursing tools, updates, and notes.">
  <meta property="og:image" content="icon-512.png">
  <meta property="og:url" content="https://heartique.github.io/HEARTIQUE-NEXUS-NURSES-ALLIANCE/">
  <meta property="og:type" content="website">

  <!-- ğŸ¦ Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Heartique Nursing Nexus Dashboard">
  <meta name="twitter:description" content="Your essential nursing study portal â€“ accessible, simple, powerful.">
  <meta name="twitter:image" content="icon-512.png">

  <!-- ğŸ§­ Icons + PWA -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#004a99">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- âœ¨ Styles -->
  <style>
    :root {
      --primary: #004a99;
      --accent: #8000ff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #333;
      background-image: url('https://raw.githubusercontent.com/heartique/HEARTIQUE-NEXUS-NURSES-ALLIANCE/main/background4.jpg');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
    }

    header {
      background: var(--primary);
      color: white;
      padding: 1rem 1.5rem;
      text-align: center;
      position: relative;
    }

    main {
      max-width: 1000px;
      margin: 1rem auto;
      padding: 1rem;
    }

    h1, h2 {
      font-weight: 700;
      color: var(--primary);
    }

    ul {
      list-style: none;
      padding-left: 0;
    }

    /* Clean layout control for section backgrounds */
    section:not(.no-bg) {
      background: white;
      padding: 1rem 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: 6px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.06);
    }

    section.no-bg {
      background: transparent;
      box-shadow: none;
      padding: 1rem 0;
    }

    /* ğŸ’  Tab Container Grid */
    .custom-tab-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      padding: 10px;
    }

    /* ğŸ§© Tab Card Look (modern & clean like MSK) */
    .custom-tab-card {
      display: block;
      background: #fff;
      border-radius: 14px;
      padding: 20px;
      text-decoration: none;
      color: #1f2937;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
      transition: all 0.3s ease;
    }

    .custom-tab-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
    }

    .tab-icon {
      font-size: 2rem;
      margin-bottom: 8px;
      color: var(--primary);
    }

    .tab-content h2 {
      margin: 0 0 6px;
      font-size: 1.2rem;
    }

    .tab-content p {
      margin: 0;
      font-size: 0.9rem;
      color: #555;
    }

    .badge {
      margin-top: 6px;
      display: inline-block;
      background: #e0ecff;
      padding: 4px 10px;
      border-radius: 10px;
      font-size: 0.75rem;
      color: #003366;
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .custom-tab-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <!-- ğŸ‘¤ Top Bar with Profile -->
  <div id="topBar" style="position: relative; display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: #f9f9f9;">
    <h1 style="color: #004a99; font-size: 1.4rem;">MY PROFILE</h1>
    <button id="profileBtn" style="border-radius: 50%; background: #004a99; color: white; font-size: 1.2rem; border: none; width: 45px; height: 45px; cursor: pointer;">
      ğŸ‘¤
    </button>
  </div>

  <!-- ğŸ‘¤ Profile Dropdown Panel -->
  <div id="profileModal" style="display: none; position: absolute; top: 70px; right: 2rem; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 1000; min-width: 220px;">
    <p><strong>Name:</strong> <span id="modalName">Loading...</span></p>
    <p><strong>Email:</strong> <span id="modalEmail">Loading...</span></p>
    <hr>
    <button onclick="deleteAccount()" style="background: red; color: white; border: none; padding: 0.5rem 1rem; margin-bottom: 0.5rem;">Delete Account</button>
    <button onclick="logout()" style="border: none; padding: 0.5rem 1rem;">Logout</button>
  </div>

  <!-- âš ï¸ Delete Confirm Modal -->
  <div id="confirmModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:2000;">
    <div style="background:white; padding:2rem; border-radius:10px; max-width:300px;">
      <h3 style="color:red;">Confirm Delete</h3>
      <p>Are you sure you want to delete this account?</p>
      <button id="confirmYes" style="background:red; color:white; margin:1rem;">Yes</button>
      <button id="confirmNo">Cancel</button>
    </div>
  </div>

  <!-- ğŸ‰ Welcome Message -->
  <main>
    <section class="no-bg">
      <div class="welcome-msg" style="background: #e8f0fe; border-left: 6px solid #004a99; padding: 1.5rem; border-radius: 6px; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
        <h1 id="greeting">Welcome!</h1>
        <p id="welcomeUser">Welcome to Heartique Nursing Nexus Portal ğŸ‘‹</p>
        <p>This is <strong>Heartique Nursing Nexus Alliance Portal</strong>, a dedicated space for nursing students across Kenya. Whether you're just starting or already advancing in your career, this space is here to support you every step of the way.</p>
        <p>Itâ€™s more than a resource hub â€” itâ€™s a powerful, simple, organized community for collaboration and growth. Youâ€™ll find notes, papers, updates, and support â€” all in one place.</p>
        <p><strong>ğŸ”¥ Join our WhatsApp channel for instant updates and study tips!</strong></p>
        <p class="contact" style="font-size: 0.9rem; margin-top: 1rem; color: #555;">
          ğŸ“§ <a href="mailto:nursingnexusalliance@gmail.com">nursingnexusalliance@gmail.com</a><br>
          ğŸ“ <a href="tel:+254717517371">+254 717 517 371</a><br>
          ğŸ’¬ <a href="https://whatsapp.com/channel/0029VbBFzgAEawdkJKtRtF2H" target="_blank">Follow WhatsApp Channel</a><br>
          ğŸ’¬ <a href="https://chat.whatsapp.com/Lad2s4XXx1AA1TtThbMgWV" target="_blank">Join Study Group</a>
        </p>
      </div>
    </section>

    <!-- ğŸ” Search Bar -->
    <input type="text" id="searchBar" placeholder="Search notes, papers, and activities..." style="width: 100%; padding: 0.7rem 1rem; font-size: 1rem; margin-top: 1rem; border: 2px solid #004a99; border-radius: 4px; box-sizing: border-box;" />
    <!-- ğŸ“š PTS & Block Notes -->
    <section>
      <h2>ğŸ“š PTS & Block Notes</h2>
      <ul id="notesList">
        <li onclick="location.href='pts.html'">PTS Revision Notes</li>
        <li onclick="location.href='block1.html'">Block 1 Notes</li>
        <li onclick="location.href='block2.html'">Block 2 Notes</li>
        <li onclick="location.href='block3.html'">Block 3 Notes</li>
        <li onclick="location.href='block4.html'">Block 4 Notes</li>
        <li onclick="location.href='block5.html'">Block 5 Notes</li>
        <li onclick="location.href='block6.html'">Block 6 Notes</li>
      </ul>
    </section>

    <!-- ğŸŒŸ Useful Quick Tabs Section -->
    <section class="no-bg">
      <h2 style="text-align: center; margin-bottom: 10px;">ğŸŒŸ Useful Quick Tabs</h2>
      <div class="custom-tab-container">

        <!-- Nurse Whispers Tab -->
        <a href="vocabulary.html" class="custom-tab-card">
          <div class="tab-icon">ğŸ“˜</div>
          <div class="tab-content">
            <h2>Nurse Whispers</h2>
            <p>Most-used nursing & medical terms in one place.</p>
            <span class="badge" id="vocab-count">Loading...</span>
          </div>
        </a>

        <!-- Medical Abbreviations Tab -->
        <a href="medicalabbreviations.html" class="custom-tab-card">
          <div class="tab-icon">âš•ï¸</div>
          <div class="tab-content">
            <h2>Med Abbreviations</h2>
            <p>Essential abbreviations every nurse must know.</p>
            <span class="badge" id="abbrev-count">Loading...</span>
          </div>
        </a>

      </div>
    </section>
    <!-- ğŸ¯ Core Objectives -->
    <section>
      <h2>ğŸ¯ Core Objectives for Nursing Students</h2>
      <ul id="objectivesList">
        <li class="main-objective-tab" onclick="location.href='objectives.html'">ğŸ“˜ Nursing Study Objectives</li>
      </ul>
    </section>

    <!-- ğŸ“š VIP Nursing Books -->
    <section>
      <h2>ğŸ“š Very Important Books & Materials</h2>
      <ul id="vipBooksList">
        <li class="main-vip-books" onclick="location.href='essentials.html'">ğŸ“˜ Core Nursing Essentials</li>
        <li class="main-vip-books" onclick="location.href='pharmacology-book.html'">ğŸ’Š Pharmacology Master Guide</li>
        <li class="main-vip-books" onclick="location.href='anatomy-diagrams.html'">ğŸ§  Anatomy & Physiology Diagrams</li>
        <li class="main-vip-books" onclick="location.href='clinical-manual.html'">ğŸ©º Clinical Procedures Manual</li>
        <li class="main-vip-books" onclick="location.href='exam-secrets.html'">ğŸ” NCK Exam Secrets & Hacks</li>
      </ul>
    </section>

    <!-- ğŸ§  Study Tools -->
    <section class="no-bg">
      <h2 style="text-align: center;">ğŸ§  Study Tools Zone</h2>
      <div class="custom-tab-container">
        <!-- Quizzes -->
        <a href="quiz.html" class="custom-tab-card">
          <div class="tab-icon">ğŸ“</div>
          <div class="tab-content">
            <h2>Heartique Quizzes</h2>
            <p>Test your knowledge with instant feedback and scores.</p>
          </div>
        </a>

        <!-- Terms & Tricks -->
        <a href="terms.html" class="custom-tab-card">
          <div class="tab-icon">ğŸ“˜</div>
          <div class="tab-content">
            <h2>Terms & Tricks</h2>
            <p>Essential medical terms and nursing hacks â€” simplified.</p>
          </div>
        </a>

        <!-- Image Gallery -->
        <a href="imagestudys.html" class="custom-tab-card">
          <div class="tab-icon">ğŸ–¼ï¸</div>
          <div class="tab-content">
            <h2>Concept Gallery</h2>
            <p>Visualize key units with clean image tabs.</p>
          </div>
        </a>
      </div>

      <div class="tools-coming-banner" style="text-align: center; margin-top: 10px; font-style: italic; color: #666;">
        ğŸ’¡ More tools coming soon...
      </div>

      <div class="tools-suggest-link" style="text-align: center; margin-top: 10px;">
        <a href="https://wa.me/254717517371?text=Hi!%20I'd%20love%20to%20suggest%20a%20feature%20for%20Heartique..." target="_blank" style="color: #2563eb; font-weight: bold;">+ Suggest a feature</a>
      </div>
    </section>
    <!-- ğŸ“„ Past Revision Papers -->
    <section>
      <h2>ğŸ“„ Past Revision Papers</h2>
      <ul id="pastPapersList">
        <li onclick="location.href='pts-revision.html'">ğŸ“š PTS Revision Portal</li>
        <li onclick="location.href='block1-revision.html'">ğŸ“š Block 1 Revision Portal</li>
        <li onclick="location.href='block2-revision.html'">ğŸ“š Block 2 Revision Portal</li>
        <li onclick="location.href='block3-revision.html'">ğŸ“š Block 3 Revision Portal</li>
        <li onclick="location.href='block4-revision.html'">ğŸ“š Block 4 Revision Portal</li>
        <li onclick="location.href='block5-revision.html'">ğŸ“š Block 5 Revision Portal</li>
        <li onclick="location.href='block6-revision.html'">ğŸ“š Block 6 Revision Portal</li>
        <li class="main-FQE-paper" onclick="location.href='FQE1.html'">âœ¨ <strong>FQE Paper 1</strong></li>
        <li class="main-FQE-paper" onclick="location.href='FQE2.html'">âœ¨ <strong>FQE Paper 2</strong></li>
        <li class="main-nck-paper" onclick="location.href='nck-paper1.html'">âœ¨ <strong>NCK Paper 1</strong></li>
        <li class="main-nck-paper" onclick="location.href='nck-paper2.html'">âœ¨ <strong>NCK Paper 2</strong></li>
      </ul>
    </section>

    <!-- âš½ Co-curricular Activities -->
    <section>
      <h2>âš½ Co-curricular Activities</h2>
      <ul id="activitiesList">
        <li onclick="location.href='football.html'">Football</li>
        <li onclick="location.href='athletics.html'">Athletics</li>
        <li onclick="location.href='volleyball.html'">Volleyball</li>
        <li onclick="location.href='basketball.html'">Basketball</li>
        <li onclick="location.href='chess.html'">Chess</li>
      </ul>
    </section>

    <!-- â­ Understanding Tracker -->
    <section>
      <h2 style="text-align: center;">â­ Understanding Tracker</h2>
      <p style="text-align: center;">Rate your understanding for each block below:</p>

      <div class="tracker" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
        <div class="tracker-item"><h3>PTS</h3><div class="stars" data-topic="PTS"></div></div>
        <div class="tracker-item"><h3>Block 1</h3><div class="stars" data-topic="Block 1"></div></div>
        <div class="tracker-item"><h3>Block 2</h3><div class="stars" data-topic="Block 2"></div></div>
        <div class="tracker-item"><h3>Block 3</h3><div class="stars" data-topic="Block 3"></div></div>
        <div class="tracker-item"><h3>Block 4</h3><div class="stars" data-topic="Block 4"></div></div>
        <div class="tracker-item"><h3>Block 5</h3><div class="stars" data-topic="Block 5"></div></div>
      </div>
    </section>

    <!-- ğŸ”š Footer -->
    <footer style="text-align: center; margin-top: 50px; padding: 1rem; font-size: 0.9rem; color: #666;">
      <p>&copy; 2025 Heartique Nursing. All rights reserved. |
        <a href="about.html">About</a> |
        <a href="contact.html">Contact</a> |
        <a href="privacy.html">Privacy Policy</a>
      </p>
    </footer>

  </main>

  <!-- âœ… Supabase JS -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const supabase = window.supabase.createClient(
    'https://fczslywprowqzgwcwhzu.supabase.co',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZjenNseXdwcm93cXpnd2N3aHp1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE4MzU1MDEsImV4cCI6MjA2NzQxMTUwMX0.IWQ1kwEPRrigvYurWRbuHQWRrHZU9K-3bbYgdH745zk'
  );

  const profileBtn = document.getElementById('profileBtn');
  const profileModal = document.getElementById('profileModal');

  function triggerRippleEffect() {
    const ripple = document.getElementById('rippleEffect');
    if (!ripple) return;
    ripple.style.opacity = '1';
    setTimeout(() => {
      ripple.style.opacity = '0';
    }, 400);
  }

  function isSessionExpired(session) {
    const now = Math.floor(Date.now() / 1000);
    return session.expires_at && session.expires_at < now;
  }

  async function loadUser() {
    const greetingEl = document.getElementById('greeting');
    const welcomeUser = document.getElementById('welcomeUser');
    const modalName = document.getElementById('modalName');
    const modalEmail = document.getElementById('modalEmail');

    let sessionData = localStorage.getItem('supabaseSession');
    let session = sessionData ? JSON.parse(sessionData) : null;

    if (!session || isSessionExpired(session)) {
      const { data } = await supabase.auth.getSession();
      session = data?.session;
      if (session) {
        localStorage.setItem('supabaseSession', JSON.stringify(session));
      } else {
        return window.location.href = 'login.html';
      }
    }

    const userId = session.user.id;
    const userEmail = session.user.email;
    let fullName = localStorage.getItem('full_name');

    if (!fullName) {
      const { data: userData, error } = await supabase
        .from('user')
        .select('full_name')
        .eq('id', userId)
        .single();

      if (!error && userData?.full_name) {
        fullName = userData.full_name;
        localStorage.setItem('full_name', fullName);
      }
    }

    if (fullName) {
      if (greetingEl) greetingEl.textContent = `Welcome, ${fullName}!`;
      if (welcomeUser) welcomeUser.textContent = `Hello ${fullName}, we're glad to have you here ğŸ‘‹`;
      if (modalName) modalName.textContent = fullName;
    }

    if (modalEmail) modalEmail.textContent = userEmail;
  }

  setTimeout(loadUser, 50);

  async function logout() {
    const confirmed = confirm("Are you sure you want to log out?");
    if (!confirmed) return;

    await supabase.auth.signOut();
    localStorage.removeItem('supabaseSession');
    window.location.href = 'login.html';
  }

  function showConfirmModal(callback) {
    const modal = document.getElementById('confirmModal');
    modal.style.display = 'flex';

    const yesBtn = document.getElementById('confirmYes');
    const noBtn = document.getElementById('confirmNo');

    const cleanup = () => {
      modal.style.display = 'none';
      yesBtn.removeEventListener('click', onConfirm);
      noBtn.removeEventListener('click', onCancel);
    };

    const onConfirm = () => {
      cleanup();
      callback(true);
    };

    const onCancel = () => {
      cleanup();
      callback(false);
    };

    yesBtn.addEventListener('click', onConfirm);
    noBtn.addEventListener('click', onCancel);
  }

  async function deleteAccount() {
    triggerRippleEffect();

    showConfirmModal(async (confirmed) => {
      if (!confirmed) return alert("Account deletion cancelled.");

      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return alert("You're not logged in.");

      const { error } = await supabase.from('user').delete().eq('id', user.id);
      if (error) return alert("âŒ Error deleting user.");

      alert("âœ… Account deleted. Logging out...");
      await supabase.auth.signOut();
      localStorage.clear();
      window.location.href = 'login.html';
    });
  }

  profileBtn?.addEventListener('click', (e) => {
    profileModal.style.display = profileModal.style.display === 'block' ? 'none' : 'block';
    triggerRippleEffect();
    e.stopPropagation();
  });

  document.addEventListener('click', (e) => {
    if (!profileModal.contains(e.target) && e.target !== profileBtn) {
      profileModal.style.display = 'none';
    }
  });

  // ğŸ” Search Filter
  const searchInput = document.getElementById("searchBar");
  const noResultsMessage = document.createElement("p");
  noResultsMessage.id = "noResultsMessage";
  noResultsMessage.textContent = "ğŸ” No matching content found.";
  noResultsMessage.style.textAlign = "center";
  noResultsMessage.style.color = "#b71c1c";
  noResultsMessage.style.fontWeight = "bold";
  noResultsMessage.style.display = "none";
  searchInput.insertAdjacentElement("afterend", noResultsMessage);

  searchInput.addEventListener("input", function () {
    const query = this.value.toLowerCase();
    const allLists = document.querySelectorAll("ul");
    let totalVisible = 0;

    allLists.forEach((list) => {
      const items = list.querySelectorAll("li");

      items.forEach((item) => {
        const text = item.textContent.toLowerCase();
        const match = text.includes(query);
        item.style.display = match ? "block" : "none";
        if (match) totalVisible++;
      });
    });

    noResultsMessage.style.display = totalVisible === 0 ? "block" : "none";
  });

  // ğŸ”¢ Fetch counts
  fetch('vocabulary.json').then(res => res.json()).then(data => {
    document.getElementById("vocab-count").innerText = `${data.length} words inside`;
  }).catch(() => {
    document.getElementById("vocab-count").innerText = `Vocabulary`;
  });

  fetch('abbreviations.json').then(res => res.json()).then(data => {
    document.getElementById("abbrev-count").innerText = `${data.length} terms inside`;
  }).catch(() => {
    document.getElementById("abbrev-count").innerText = `Abbreviations`;
  });

  // â­ Tracker Logic
  const topics = document.querySelectorAll(".stars");
  topics.forEach(starBlock => {
    const topicKey = starBlock.getAttribute("data-topic");
    const savedRating = localStorage.getItem("rating-" + topicKey) || 0;

    for (let i = 1; i <= 5; i++) {
      const star = document.createElement("span");
      star.classList.add("star");
      star.innerHTML = "â˜…";
      if (i <= savedRating) star.classList.add("filled");

      star.addEventListener("click", () => {
        localStorage.setItem("rating-" + topicKey, i);
        updateStars(starBlock, i);
      });

      starBlock.appendChild(star);
    }
  });

  function updateStars(container, rating) {
    const stars = container.querySelectorAll(".star");
    stars.forEach((star, idx) => {
      star.classList.toggle("filled", idx < rating);
    });
  }
</script>

</body>
</html>
