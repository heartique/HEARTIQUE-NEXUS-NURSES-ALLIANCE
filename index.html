<!DOCTYPE html>
<html lang="en">
<head>
  <!-- 🌙 Dark Theme Setup -->
  <script>
    const savedTheme = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const theme = savedTheme || (prefersDark ? "dark" : "light");
    document.documentElement.setAttribute("data-theme", theme);
  </script>

  <!-- 📚 Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Manrope:wght@400;700&display=swap" rel="stylesheet">

  <!-- ⚙ Meta -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Heartique Nexus Dashboard</title>
  <meta name="description" content="The ultimate dashboard for Heartique Nursing Nexus – study tools, updates, and essential nursing resources.">
  <meta name="keywords" content="nursing, notes, dashboard, CHK, Heartique nursing nexus alliance, study, PTS, Kenya">
  <meta name="author" content="Heartique Nursing Nexus Team">
  <meta name="robots" content="index, follow">

  <!-- 🔗 Open Graph & Twitter -->
  <meta property="og:title" content="Heartique Nursing Nexus Dashboard">
  <meta property="og:description" content="Your go-to platform for nursing tools, updates, and notes.">
  <meta property="og:image" content="icon-512.png">
  <meta property="og:url" content="https://heartique.github.io/HEARTIQUE-NEXUS-NURSES-ALLIANCE/">
  <meta property="og:type" content="website">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Heartique Nursing Nexus Dashboard">
  <meta name="twitter:description" content="Your essential nursing study portal – accessible, simple, powerful.">
  <meta name="twitter:image" content="icon-512.png">

  <!-- 📱 PWA + Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#004a99">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- 🌈 Optional: Tailwind (comment if using custom CSS) -->
  <!-- <script src="https://cdn.tailwindcss.com"></script> -->

  <style>
    body {
      font-family: 'Manrope', sans-serif;
      background: radial-gradient(circle at top left, #0d1117, #121212);
      color: #e0e0e0;
      margin: 0;
      padding: 0;
    }

    h1, h2, h3 {
      font-family: 'Orbitron', sans-serif;
    }

    header {
      background: rgba(0, 74, 153, 0.8);
      backdrop-filter: blur(10px);
      color: white;
      padding: 1rem 1.5rem;
      text-align: center;
      position: relative;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .star {
  color: #666;
  transition: color 0.3s ease, transform 0.3s ease;
  text-shadow: 0 0 2px #00e5ff;
}
.star:hover {
  transform: scale(1.2);
}
.star.filled {
  color: #ffc107;
  text-shadow: 0 0 8px #ffc107;
}

  </style>
</head>
<body style="margin: 0; padding: 0; font-family: 'Manrope', sans-serif; background-color: #0d1117;">

<!-- 👤 Top Glass Bar -->
<div id="topBar" style="backdrop-filter: blur(12px); background: rgba(13, 17, 23, 0.85); border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; position: relative; z-index: 10;">
  <h1 style="color: #00bcd4; font-family: 'Orbitron', sans-serif; font-size: 1.5rem;">MY PROFILE</h1>
  <button id="profileBtn" style="border-radius: 50%; background: #004a99; color: white; font-size: 1.2rem; border: none; width: 45px; height: 45px; cursor: pointer; box-shadow: 0 0 10px rgba(0,74,153,0.6); transition: transform 0.2s;">
    👤
  </button>
</div>

<!-- 👤 Profile Dropdown -->
<div id="profileModal" style="display: none; position: absolute; top: 70px; right: 2rem; background: rgba(30, 30, 30, 0.95); padding: 1rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); z-index: 1000; min-width: 220px; color: #eee;">
  <p><strong>Name:</strong> <span id="modalName">Loading...</span></p>
  <p><strong>Email:</strong> <span id="modalEmail">Loading...</span></p>
  <hr style="border-color: #444;">
  <button onclick="deleteAccount()" style="background: #e53935; color: white; border: none; padding: 0.5rem 1rem; margin-bottom: 0.5rem; width: 100%; border-radius: 6px;">Delete Account</button>
  <button onclick="logout()" style="background: #555; color: white; border: none; padding: 0.5rem 1rem; width: 100%; border-radius: 6px;">Logout</button>
</div>

<!-- ❗ Confirm Delete Modal -->
<div id="confirmModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:2000;">
  <div style="background:#1e1e1e; color: white; padding:2rem; border-radius:10px; max-width:300px;">
    <h3 style="color:#ff5252;">Confirm Delete</h3>
    <p>Are you sure you want to delete this account?</p>
    <button id="confirmYes" style="background:#ff5252; color:white; margin:1rem; border:none; padding:0.5rem 1rem; border-radius:6px;">Yes</button>
    <button id="confirmNo" style="background:#444; color:white; padding:0.5rem 1rem; border:none; border-radius:6px;">Cancel</button>
  </div>
</div>

<!-- 🔊 Notification Sound -->
<audio id="notifySound" src="notify.mp3" preload="auto"></audio>

<!-- 🚀 Hero Header -->
<header style="background: rgba(0, 74, 153, 0.85); backdrop-filter: blur(10px); padding: 2rem 1rem; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.05);">
  <h1 style="font-family: 'Orbitron', sans-serif; font-size: 1.8rem; color: #ffffff;">WELCOME TO HEARTIQUE NURSING NEXUS PORTAL❤️</h1>
</header>

<!-- 🎉 Welcome Message -->
<main style="max-width: 1000px; margin: 2rem auto; padding: 1rem;">
  <div class="welcome-msg" style="background: rgba(0, 0, 0, 0.5); border-left: 6px solid #00bcd4; padding: 1.5rem; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
    <h1 id="greeting" style="color: #00e5ff;">Welcome!</h1>
    <p id="welcomeUser" style="color: #e0f7fa;">We’re glad to have you on the Heartique Nursing Nexus Alliance Portal 👋</p>
    <p>This is <strong>Heartique Nursing Nexus Alliance Portal</strong> — a dedicated space for all nursing students in Kenya.</p>
    <p><em>With quick access to PTS notes, Blocks 1–6, revision papers & community updates — all in one place.</em></p>
    <p><strong>Join our WhatsApp channel for alerts + tips!</strong></p>
    <p class="contact" style="color: #90caf9;">
      📧 <a href="mailto:nursingnexusalliance@gmail.com" style="color: #81d4fa;">nursingnexusalliance@gmail.com</a><br>
      📞 <a href="tel:+254717517371" style="color: #81d4fa;">+254 717 517 371</a><br>
      💬 <a href="https://whatsapp.com/channel/0029VbBFzgAEawdkJKtRtF2H" target="_blank" style="color: #81d4fa;">WhatsApp Channel</a><br>
      💬 <a href="https://chat.whatsapp.com/Lad2s4XXx1AA1TtThbMgWV" target="_blank" style="color: #81d4fa;">Study Group</a>
    </p>
  </div>

  <!-- 🔍 Search -->
  <input type="text" id="searchBar" placeholder="Search notes, papers, and activities..." style="width: 100%; padding: 0.75rem 1rem; font-size: 1rem; border-radius: 8px; border: 1px solid #00bcd4; background: rgba(255,255,255,0.05); color: #eee; box-shadow: inset 0 0 5px rgba(0,0,0,0.3); margin-top: 1rem;" />

  <!-- 📢 Noticeboard -->
  <div id="noticeboard" style="background: rgba(255, 248, 220, 0.15); border-left: 6px solid #ffa500; padding: 12px 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); color: #fff;">
    <h3 style="margin-top: 0; color: #ffb74d;">📢 Noticeboard <span id="newBadge" style="color: red; font-size: 0.9em; display: none;">(New)</span></h3>
    <button id="toggleNotice" style="padding: 6px 12px; background: #ff9800; border: none; border-radius: 4px; color: white; cursor: pointer;">Show Notices</button>
    <ul id="notices" style="margin: 0; padding-left: 20px; display: none; transition: all 0.5s ease-in-out; max-height: 0; overflow: hidden;"></ul>
  </div>
<section class="quiz-tools-section" style="background: rgba(255,255,255,0.02); border-radius: 20px; padding: 2rem; margin: 3rem auto; max-width: 1200px; box-shadow: 0 8px 24px rgba(0,0,0,0.15);">
  <h2 class="section-title" style="font-family: 'Orbitron', sans-serif; font-size: 1.8rem; color: #00e5ff; text-align: center; margin-bottom: 2rem;">
    🧠 Study Tools Zone
  </h2>

  <div class="quiz-tab-container" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px;">

    <!-- QUIZZES APP -->
    <a href="quiz.html" class="quiz-tab-card" style="
      flex: 1 1 280px;
      max-width: 340px;
      border-radius: 16px;
      background: linear-gradient(135deg, #0d47a1, #00acc1);
      color: #fff;
      padding: 1.5rem;
      text-decoration: none;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 8px 16px rgba(0,0,0,0.25);
    ">
      <div style="font-size: 2rem;">📝</div>
      <h2 style="margin: 0.5rem 0; font-family: 'Orbitron'; font-size: 1.2rem;">HEARTIQUE QUIZZES APP🫡</h2>
      <p>Test your knowledge with instant feedback & scores.</p>
    </a>

    <!-- TERMS & TRICKS -->
    <a href="terms.html" class="quiz-tab-card" style="
      flex: 1 1 280px;
      max-width: 340px;
      border-radius: 16px;
      background: linear-gradient(135deg, #6a1b9a, #ab47bc);
      color: #fff;
      padding: 1.5rem;
      text-decoration: none;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 8px 16px rgba(0,0,0,0.25);
    ">
      <div style="font-size: 2rem;">📘</div>
      <h2 style="margin: 0.5rem 0; font-family: 'Orbitron'; font-size: 1.2rem;">Terms & Tricks</h2>
      <p>Explore smart nursing tricks explained simply.</p>
    </a>

    <!-- IMAGE STUDY GALLERY -->
    <a href="imagestudys.html" class="quiz-tab-card" style="
      flex: 1 1 280px;
      max-width: 340px;
      border-radius: 16px;
      background: linear-gradient(135deg, #004d40, #009688);
      color: #fff;
      padding: 1.5rem;
      text-decoration: none;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 8px 16px rgba(0,0,0,0.25);
    ">
      <div style="font-size: 2rem;">🖼️</div>
      <h2 style="margin: 0.5rem 0; font-family: 'Orbitron'; font-size: 1.2rem;">MEDICAL CONCEPT GALLERY</h2>
      <p>Visualize key nursing & medical units in image form.</p>
    </a>

  </div>

  <!-- 💡 Coming Soon -->
  <div class="tools-coming-banner" style="text-align: center; font-style: italic; color: #90caf9; margin-top: 2rem;">
    💡 More tools coming soon...
  </div>

  <!-- 🔗 Suggest Feature -->
  <div class="tools-suggest-link" style="text-align: center; margin-top: 1rem;">
    <a href="https://wa.me/254717517371?text=Hi!%20I'd%20love%20to%20suggest%20a%20feature%20for%20Heartique..." target="_blank" style="color: #00bcd4; font-weight: bold; text-decoration: none;">+ Suggest a feature</a>
  </div>
</section>
<!-- 🎯 Core Objectives -->
<section style="background: rgba(255,255,255,0.03); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 2rem;">
  <h2 style="font-family: 'Orbitron'; color: #80d8ff;">🎯 Core Objectives for Nursing Students</h2>
  <ul id="objectivesList" style="list-style: none; padding: 0;">
    <li class="main-objective-tab" onclick="location.href='objectives.html'" style="
      background: linear-gradient(135deg, #4a148c, #880e4f);
      color: #fff;
      font-weight: 900;
      font-size: 1.2rem;
      border-radius: 14px;
      border: 3px solid #ce93d8;
      padding: 1.5rem 1rem;
      margin: 1rem 0;
      box-shadow: 0 0 15px rgba(136,14,79,0.4);
      text-align: center;
      transition: transform 0.3s ease;
    ">
      📘 Nursing Study Objectives
    </li>
  </ul>
</section>

<!-- 📚 VIP BOOKS -->
<section style="background: rgba(255,255,255,0.03); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 2rem;">
  <h2 style="font-family: 'Orbitron'; color: #90caf9;">📚 Very Important Books & Materials</h2>
  <ul id="vipBooksList" style="list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 16px;">
    <li class="main-vip-books" onclick="location.href='essentials.html'" style="background: linear-gradient(135deg, #0d47a1, #1565c0); color: white; padding: 1rem; border-radius: 14px; text-align: center; font-weight: bold;">📘 Core Nursing Essentials</li>
    <li class="main-vip-books" onclick="location.href='pharmacology-book.html'" style="background: linear-gradient(135deg, #880e4f, #d81b60); color: white; padding: 1rem; border-radius: 14px; text-align: center; font-weight: bold;">💊 Pharmacology Master Guide</li>
    <li class="main-vip-books" onclick="location.href='anatomy-diagrams.html'" style="background: linear-gradient(135deg, #4a148c, #7b1fa2); color: white; padding: 1rem; border-radius: 14px; text-align: center; font-weight: bold;">🧠 Anatomy & Physiology Diagrams</li>
    <li class="main-vip-books" onclick="location.href='clinical-manual.html'" style="background: linear-gradient(135deg, #00695c, #00897b); color: white; padding: 1rem; border-radius: 14px; text-align: center; font-weight: bold;">🩺 Clinical Procedures Manual</li>
    <li class="main-vip-books" onclick="location.href='exam-secrets.html'" style="background: linear-gradient(135deg, #4e342e, #6d4c41); color: white; padding: 1rem; border-radius: 14px; text-align: center; font-weight: bold;">🔐 NCK Exam Secrets & Hacks</li>
  </ul>
</section>

<!-- ✨ Past Papers -->
<section style="background: rgba(255,255,255,0.03); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 2rem;">
  <h2 style="font-family: 'Orbitron'; color: #64b5f6;">📄 Past Revision Papers</h2>
  <ul id="pastPapersList" style="list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 16px;">
    <li onclick="location.href='pts-revision.html'" style="background: #263238; color: #fff; padding: 1rem; border-radius: 10px; cursor: pointer;">📚 PTS Revision Portal</li>
    <li onclick="location.href='block1-revision.html'" style="background: #1a237e; color: #fff; padding: 1rem; border-radius: 10px;">📚 Block 1 Revision Portal</li>
    <li onclick="location.href='block2-revision.html'" style="background: #283593; color: #fff; padding: 1rem; border-radius: 10px;">📚 Block 2 Revision Portal</li>
    <li onclick="location.href='block3-revision.html'" style="background: #3949ab; color: #fff; padding: 1rem; border-radius: 10px;">📚 Block 3 Revision Portal</li>
    <li onclick="location.href='block4-revision.html'" style="background: #1e88e5; color: #fff; padding: 1rem; border-radius: 10px;">📚 Block 4 Revision Portal</li>
    <li onclick="location.href='block5-revision.html'" style="background: #42a5f5; color: #fff; padding: 1rem; border-radius: 10px;">📚 Block 5 Revision Portal</li>
    <li onclick="location.href='block6-revision.html'" style="background: #64b5f6; color: #fff; padding: 1rem; border-radius: 10px;">📚 Block 6 Revision Portal</li>
    <li onclick="location.href='FQE1.html'" class="main-FQE-paper" style="background: #9c27b0; color: #fff; padding: 1rem; border-radius: 12px;"><strong>✨ FQE Paper 1</strong></li>
    <li onclick="location.href='FQE2.html'" class="main-FQE-paper" style="background: #ba68c8; color: #fff; padding: 1rem; border-radius: 12px;"><strong>✨ FQE Paper 2</strong></li>
    <li onclick="location.href='nck-paper1.html'" class="main-nck-paper" style="background: #f44336; color: #fff; padding: 1rem; border-radius: 12px;"><strong>✨ NCK Paper 1</strong></li>
    <li onclick="location.href='nck-paper2.html'" class="main-nck-paper" style="background: #ef5350; color: #fff; padding: 1rem; border-radius: 12px;"><strong>✨ NCK Paper 2</strong></li>
  </ul>
</section>
<section id="understandingTracker" style="margin: 40px auto; max-width: 800px; font-family: 'Manrope', sans-serif;">
  <h2 style="text-align: center; font-family: 'Orbitron'; font-size: 1.6rem; color: #00e5ff;">⭐ Understanding Tracker</h2>
  <p style="text-align: center; margin-bottom: 30px; color: #b0bec5;">Rate your understanding of each topic or block below:</p>

  <div class="tracker-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px;">
    
    <!-- ONE CARD TEMPLATE -->
    <div class="tracker-item" style="background: rgba(255,255,255,0.05); border: 1px solid #00bcd4; border-radius: 16px; padding: 1.5rem; color: #e0f7fa; text-align: center; box-shadow: 0 0 10px rgba(0,188,212,0.3);">
      <h3 style="font-family: 'Orbitron'; font-size: 1.1rem;">PTS (Professional Training Skills)</h3>
      <div class="stars" data-topic="PTS" style="margin-top: 10px;"></div>
    </div>

    <div class="tracker-item" style="background: rgba(255,255,255,0.05); border: 1px solid #42a5f5; border-radius: 16px; padding: 1.5rem; color: #bbdefb; text-align: center; box-shadow: 0 0 10px rgba(66,165,245,0.3);">
      <h3 style="font-family: 'Orbitron'; font-size: 1.1rem;">Block 1</h3>
      <div class="stars" data-topic="Block 1" style="margin-top: 10px;"></div>
    </div>

    <div class="tracker-item" style="background: rgba(255,255,255,0.05); border: 1px solid #4db6ac; border-radius: 16px; padding: 1.5rem; color: #b2dfdb; text-align: center; box-shadow: 0 0 10px rgba(77,182,172,0.3);">
      <h3 style="font-family: 'Orbitron'; font-size: 1.1rem;">Block 2</h3>
      <div class="stars" data-topic="Block 2" style="margin-top: 10px;"></div>
    </div>

    <div class="tracker-item" style="background: rgba(255,255,255,0.05); border: 1px solid #9575cd; border-radius: 16px; padding: 1.5rem; color: #d1c4e9; text-align: center; box-shadow: 0 0 10px rgba(149,117,205,0.3);">
      <h3 style="font-family: 'Orbitron'; font-size: 1.1rem;">Block 3</h3>
      <div class="stars" data-topic="Block 3" style="margin-top: 10px;"></div>
    </div>

    <div class="tracker-item" style="background: rgba(255,255,255,0.05); border: 1px solid #f06292; border-radius: 16px; padding: 1.5rem; color: #f8bbd0; text-align: center; box-shadow: 0 0 10px rgba(240,98,146,0.3);">
      <h3 style="font-family: 'Orbitron'; font-size: 1.1rem;">Block 4</h3>
      <div class="stars" data-topic="Block 4" style="margin-top: 10px;"></div>
    </div>

    <div class="tracker-item" style="background: rgba(255,255,255,0.05); border: 1px solid #ffb74d; border-radius: 16px; padding: 1.5rem; color: #ffe082; text-align: center; box-shadow: 0 0 10px rgba(255,183,77,0.3);">
      <h3 style="font-family: 'Orbitron'; font-size: 1.1rem;">Block 5</h3>
      <div class="stars" data-topic="Block 5" style="margin-top: 10px;"></div>
    </div>

  </div>
</section>
<footer style="
  margin-top: 60px;
  padding: 1.5rem 1rem;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255, 255, 255, 0.05);
  text-align: center;
  font-size: 0.95rem;
  color: #b0bec5;
  font-family: 'Manrope', sans-serif;
  box-shadow: 0 -2px 12px rgba(0,0,0,0.4);
">
  <p style="margin: 0;">
    &copy; 2025 <span style="color: #00e5ff;">Heartique Nursing Nexus</span>. All rights reserved.
  </p>
  <div style="margin-top: 0.5rem;">
    <a href="about.html" style="color: #81d4fa; margin: 0 8px; text-decoration: none;">About</a> |
    <a href="contact.html" style="color: #81d4fa; margin: 0 8px; text-decoration: none;">Contact</a> |
    <a href="privacy.html" style="color: #81d4fa; margin: 0 8px; text-decoration: none;">Privacy Policy</a>
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  // 🎮 INIT SUPABASE
  const supabase = window.supabase.createClient(
    'https://fczslywprowqzgwcwhzu.supabase.co',
    'YOUR_PUBLIC_ANON_KEY_HERE'
  );

  // 🌊 RIPPLE EFFECT BAR
  const rippleEffect = document.getElementById('rippleEffect');
  function triggerRippleEffect() {
    rippleEffect.style.opacity = '1';
    setTimeout(() => rippleEffect.style.opacity = '0', 400);
  }

  // 👤 PROFILE MODAL & SESSION HANDLING
  const profileBtn = document.getElementById('profileBtn');
  const profileModal = document.getElementById('profileModal');

  profileBtn?.addEventListener('click', (e) => {
    profileModal.style.display = profileModal.style.display === 'block' ? 'none' : 'block';
    triggerRippleEffect();
    e.stopPropagation();
  });

  document.addEventListener('click', (e) => {
    if (!profileModal.contains(e.target) && e.target !== profileBtn) {
      profileModal.style.display = 'none';
    }
  });

  function isSessionExpired(session) {
    const now = Math.floor(Date.now() / 1000);
    return session.expires_at && session.expires_at < now;
  }

  async function loadUser() {
    let session = JSON.parse(localStorage.getItem('supabaseSession')) || null;
    const greetingEl = document.getElementById('greeting');
    const welcomeUser = document.getElementById('welcomeUser');
    const modalName = document.getElementById('modalName');
    const modalEmail = document.getElementById('modalEmail');

    if (!session || isSessionExpired(session)) {
      const { data } = await supabase.auth.getSession();
      session = data?.session;
      if (session) localStorage.setItem('supabaseSession', JSON.stringify(session));
      else return (window.location.href = 'login.html');
    }

    const userId = session.user.id;
    const userEmail = session.user.email;
    let fullName = localStorage.getItem('full_name');

    if (!fullName) {
      const { data: userData } = await supabase.from('user').select('full_name').eq('id', userId).single();
      fullName = userData?.full_name;
      if (fullName) localStorage.setItem('full_name', fullName);
    }

    if (fullName) {
      greetingEl.textContent = `Welcome, ${fullName}!`;
      welcomeUser.textContent = `Hello ${fullName}, we're glad to have you on the Nursing Nexus Portal 👋`;
      modalName.textContent = fullName;
    }

    modalEmail.textContent = userEmail;
  }

  setTimeout(loadUser, 50);

  // 🔐 LOGOUT
  async function logout() {
    if (!confirm("Are you sure you want to log out?")) return;
    await supabase.auth.signOut();
    localStorage.removeItem('supabaseSession');
    window.location.href = 'login.html';
  }

  // ❌ DELETE ACCOUNT
  function showConfirmModal(callback) {
    const modal = document.getElementById('confirmModal');
    modal.style.display = 'flex';

    const yesBtn = document.getElementById('confirmYes');
    const noBtn = document.getElementById('confirmNo');

    const cleanup = () => {
      modal.style.display = 'none';
      yesBtn.removeEventListener('click', onConfirm);
      noBtn.removeEventListener('click', onCancel);
    };

    const onConfirm = () => { cleanup(); callback(true); };
    const onCancel = () => { cleanup(); callback(false); };

    yesBtn.addEventListener('click', onConfirm);
    noBtn.addEventListener('click', onCancel);
  }

  async function deleteAccount() {
    triggerRippleEffect();
    showConfirmModal(async (confirmed) => {
      if (!confirmed) return alert("Cancelled.");
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) return alert("You're not logged in.");
      const { error } = await supabase.from('user').delete().eq('id', user.id);
      if (error) return alert("❌ Failed to delete.");
      alert("✅ Deleted. Logging out...");
      await supabase.auth.signOut();
      localStorage.clear();
      window.location.href = 'login.html';
    });
  }

  // 🌟 STAR TRACKER (Local Ratings)
  const topics = document.querySelectorAll(".stars");
  topics.forEach(starBlock => {
    const topicKey = starBlock.getAttribute("data-topic");
    const savedRating = localStorage.getItem("rating-" + topicKey) || 0;

    for (let i = 1; i <= 5; i++) {
      const star = document.createElement("span");
      star.classList.add("star");
      star.innerHTML = "★";
      if (i <= savedRating) star.classList.add("filled");

      star.addEventListener("click", () => {
        localStorage.setItem("rating-" + topicKey, i);
        updateStars(starBlock, i);
      });

      starBlock.appendChild(star);
    }
  });

  function updateStars(container, rating) {
    container.querySelectorAll(".star").forEach((star, i) => {
      star.classList.toggle("filled", i < rating);
    });
  }

  // 🔍 SEARCH FILTER
  const searchInput = document.getElementById("searchBar");
  const noResultsMessage = document.createElement("p");
  noResultsMessage.id = "noResultsMessage";
  noResultsMessage.textContent = "🔍 No matching content found.";
  noResultsMessage.style = "text-align: center; color: #f44336; font-weight: bold; display: none;";
  searchInput.insertAdjacentElement("afterend", noResultsMessage);

  searchInput.addEventListener("input", function () {
    const query = this.value.toLowerCase();
    const allLists = document.querySelectorAll("ul");
    let totalVisible = 0;

    allLists.forEach(list => {
      list.querySelectorAll("li").forEach(item => {
        const match = item.textContent.toLowerCase().includes(query);
        item.style.display = match ? "block" : "none";
        if (match) totalVisible++;
      });
    });

    noResultsMessage.style.display = totalVisible === 0 ? "block" : "none";
  });

  // 📊 VOCAB/ABBREV COUNT FETCH
  fetch('vocabulary.json')
    .then(res => res.json())
    .then(data => document.getElementById("vocab-count").innerText = `${data.length} words inside`)
    .catch(() => document.getElementById("vocab-count").innerText = `Vocabulary`);

  fetch('abbreviations.json')
    .then(res => res.json())
    .then(data => document.getElementById("abbrev-count").innerText = `${data.length} terms inside`)
    .catch(() => document.getElementById("abbrev-count").innerText = `Abbreviations`);

  // 🛎 NOTICEBOARD
  const noticeList = document.getElementById('notices');
  const toggleBtn = document.getElementById('toggleNotice');
  const toast = document.getElementById("toast");
  const badge = document.getElementById('newBadge');
  const notifySound = document.getElementById('notifySound');

  toggleBtn.addEventListener('click', () => {
    const show = noticeList.classList.toggle('show');
    toggleBtn.textContent = show ? 'Hide Notices' : 'Show Notices';
    noticeList.style.maxHeight = show ? "1000px" : "0";
    noticeList.style.display = show ? "block" : "none";
    if (show) {
      badge.style.display = "none";
      const ids = Array.from(noticeList.querySelectorAll('li')).map(li => li.dataset.id);
      localStorage.setItem('seenNotices', JSON.stringify(ids));
    }
  });

  function playSound() {
    notifySound.play().catch(() => {
      document.body.addEventListener('click', () => notifySound.play(), { once: true });
    });
  }

  function showToast(msg) {
    toast.textContent = msg;
    toast.style.visibility = "visible";
    toast.className = "show";
    setTimeout(() => { toast.style.visibility = "hidden"; toast.className = ""; }, 3000);
  }

  function fetchNotices() {
    fetch('notices.json?nocache=' + Date.now())
      .then(res => res.json())
      .then(data => {
        const seen = JSON.parse(localStorage.getItem('seenNotices') || '[]');
        const newNotices = [];

        noticeList.innerHTML = "";
        data.forEach(item => {
          const li = document.createElement('li');
          li.innerHTML = `<strong>${item.date}:</strong> ${item.message}`;
          li.dataset.id = item.id;
          noticeList.appendChild(li);
          if (!seen.includes(item.id)) newNotices.push(item.id);
        });

        if (newNotices.length) {
          badge.style.display = 'inline';
          playSound();
          showToast("📢 New notice available! Click 'Show Notices' to stop alert.");
        }
      })
      .catch(err => {
        console.error("Notice load error:", err);
        noticeList.innerHTML = "<li>Failed to load notices.</li>";
      });
  }

  fetchNotices();
  setInterval(fetchNotices, 10000);

  // 🔁 REFRESH BUTTON
  const refreshBtn = document.getElementById('refreshBtn');
  const shockwave = document.getElementById('shockwave');
  refreshBtn.addEventListener('click', () => {
    shockwave.style.transition = 'none';
    shockwave.style.opacity = '1';
    shockwave.style.transform = 'scale(1)';
    void shockwave.offsetWidth;
    shockwave.style.transition = 'transform 0.6s ease-out, opacity 0.6s ease-out';
    shockwave.style.transform = 'scale(8)';
    shockwave.style.opacity = '0';
    setTimeout(() => location.reload(true), 500);
  });

  // 📲 PWA INSTALL
  let deferredPrompt;
  const installButton = document.getElementById('installApp');
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;

  if (!isStandalone) {
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.style.display = 'block';
      installButton.addEventListener('click', () => {
        installButton.style.display = 'none';
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome !== 'accepted') {
            setTimeout(() => installButton.style.display = 'block', 30000);
          }
          deferredPrompt = null;
        });
      });
    });
  }
</script>
</body>
</html>
