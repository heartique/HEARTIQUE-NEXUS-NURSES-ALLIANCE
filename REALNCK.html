<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Heartique Nursing Nexus NCK Simulation Platform</title>
  <link rel="icon" href="favicon.png" />
  <style>
    html, body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    header {
      background: #002147;
      color: white;
      padding: 1rem 2rem;
      text-align: center;
    }
    .tab-bar {
      display: none;
      flex-wrap: wrap;
      justify-content: center;
      background: #f0f0f0;
      padding: 10px;
      border-bottom: 2px solid #ccc;
    }
    .tab-btn {
      margin: 5px;
      padding: 10px 16px;
      border: none;
      background: #ccc;
      font-weight: bold;
      cursor: pointer;
      border-radius: 5px;
      transition: 0.2s ease-in-out;
    }
    .tab-btn.active {
      background: #002147;
      color: white;
    }
    .tab-btn.disabled {
      background: #999;
      color: #eee;
      cursor: not-allowed;
    }
    .container {
      display: none;
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .question-box { margin-bottom: 20px; }
    .btn {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      background: #e0e0e0;
      border: none;
      border-radius: 4px;
      text-align: left;
    }
    .btn:hover { background: #d0d0d0; }
    #navigation {
      text-align: center;
      margin-top: 20px;
    }
    #navigation button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      background: #002147;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #timer {
      text-align: center;
      font-size: 18px;
      margin-top: 10px;
      font-weight: bold;
    }
    #timer.red { color: red; }
    footer {
      text-align: center;
      font-size: 14px;
      margin-top: 50px;
      color: #777;
    }
    .form-page {
      max-width: 700px;
      margin: 50px auto;
      padding: 40px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    .form-page input {
      padding: 10px;
      width: 90%;
      margin: 10px 0;
      font-size: 16px;
    }
    .form-page button {
      padding: 12px 25px;
      font-size: 16px;
      background: #002147;
      color: white;
      border: none;
      border-radius: 5px;
      margin-top: 10px;
      cursor: pointer;
    }
    #transcript {
      display: none;
      padding: 30px;
      max-width: 800px;
      margin: auto;
      background: white;
    }
    #transcript button {
      float: right;
      background: #002147;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      margin-bottom: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="intro-page" class="form-page">
  <h2>Welcome To Heartique Nursing Nexus NCK Simulation Platform</h2>
  <p>Enter your details to begin:</p>
  <input type="text" id="full-name" placeholder="Full Name" required />
  <input type="tel" id="phone-number" placeholder="WhatsApp Number (e.g. 254712345678)" required />
  <input type="text" id="reason" placeholder="Reason (e.g. Revision, Mock...)" required />
  <button onclick="proceedToInstructions()">Continue</button>
</div>

<div id="start-page" class="form-page" style="display:none;">
  <h2>Instructions</h2>
  <ul style="text-align:left;max-width:500px;margin:20px auto;">
    <li>Each question is allocated 1.5 minutes.</li>
    <li>Do not refresh the page.</li>
    <li>Use full-screen mode during the simulation.</li>
    <li>Attempt all questions.</li>
    <li>Stay in a quiet environment.</li>
  </ul>
  <button onclick="startApp()">Start Simulation</button>
</div>

<header>
  <h1>Heartique Nursing Nexus NCK Simulation Platform</h1>
  <p>Simulated Environment for Mock and Main Exam Preparation</p>
</header>

<div class="tab-bar" id="quiz-tabs"></div>
<div class="container" id="quiz-container"></div>
<div id="navigation"></div>
<div id="timer">Time Left: 00:00</div>

<footer>
  &copy; 2025 Heartique Nursing Nexus Alliance â€“ Simulation Platform.<br>
  Contact: <a href="mailto:nursingnexusalliance@gmail.com">nursingnexusalliance@gmail.com</a> | 
  Phone: <a href="tel:0102702271">0102702271</a>
</footer>

<div id="transcript">
  <button onclick="window.print()">ðŸ“„ Download / Print Transcript</button>
  <div id="transcriptContent"></div>
</div>

<script>
let userName = "", userPhone = "", userReason = "";
let current = 0, flagged = new Set(), questions = [], fileName = "";
let saved = {}, timer, timeLeft;
let isSimulationMode = false;

const fileList = [
  { name: "MOCK 1", file: "mock1.json" },
  { name: "MOCK 2", file: "mock2.json" },
  { name: "NCK 1", file: "nck1.json" },
  { name: "FINAL TEST", file: "final.json" }
];

window.onload = () => {
  const savedData = JSON.parse(localStorage.getItem("nckUserData") || "{}");
  if (savedData.name) document.getElementById("full-name").value = savedData.name;
  if (savedData.phone) document.getElementById("phone-number").value = savedData.phone;
  if (savedData.reason) document.getElementById("reason").value = savedData.reason;
};

function proceedToInstructions() {
  const name = document.getElementById("full-name").value.trim();
  const phone = document.getElementById("phone-number").value.trim();
  const reason = document.getElementById("reason").value.trim();

  if (name.length < 3) return alert("Enter full name");
  if (!/^254(1|7)\d{8}$/.test(phone)) return alert("Enter valid Kenyan number");
  if (reason.length < 3) return alert("Enter a reason");

  userName = name;
  userPhone = phone;
  userReason = reason;
  localStorage.setItem("nckUserData", JSON.stringify({ name, phone, reason }));

  document.getElementById("intro-page").style.display = "none";
  document.getElementById("start-page").style.display = "block";
}

function startApp() {
  document.getElementById("start-page").style.display = "none";
  document.querySelector(".tab-bar").style.display = "flex";
  document.querySelector(".container").style.display = "block";
}

const tabsDiv = document.getElementById('quiz-tabs');
fileList.forEach((item) => {
  const btn = document.createElement('button');
  btn.className = 'tab-btn';
  btn.textContent = item.name;
  btn.onclick = () => loadQuiz(item.file, btn);
  tabsDiv.appendChild(btn);
});

function loadQuiz(file, activeBtn) {
  clearInterval(timer);
  fileName = file;
  current = 0;
  flagged = new Set();
  saved = {};
  isSimulationMode = file.toLowerCase().includes("nck") || file.toLowerCase().includes("final");

  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  activeBtn.classList.add('active');

  fetch(file).then(res => res.json()).then(data => {
    questions = data;
    startTimer(questions.length);
    render(current);
  });
}

function render(i) {
  const q = questions[i];
  const opts = q.options || {};
  const container = document.getElementById("quiz-container");
  container.innerHTML = `<div class="question-box"><strong>Question ${i + 1}:</strong><br><br>${q.question}<br><br></div>`;
  const box = container.querySelector('.question-box');

  for (const [k, v] of Object.entries(opts)) {
    const b = document.createElement('button');
    b.className = 'btn';
    b.textContent = `${k}) ${v}`;
    if (saved[i]) b.disabled = true;
    b.onclick = () => {
      if (saved[i]) return;
      saved[i] = { selected: k, correct: k === q.answer };
      b.disabled = true;
      if (isSimulationMode) next();
    };
    box.appendChild(b);
  }

  document.getElementById("navigation").innerHTML = `
    ${i > 0 ? `<button onclick="prev()">Previous</button>` : ""}
    <button onclick="next()">Next</button>
    <button onclick="submitTest()">Submit</button>
  `;
}

function prev() { if (current > 0) { current--; render(current); } }
function next() { if (current < questions.length - 1) { current++; render(current); } }

function startTimer(qCount) {
  timeLeft = qCount * 90;
  const timerEl = document.getElementById("timer");
  timer = setInterval(() => {
    timeLeft--;
    const min = String(Math.floor(timeLeft / 60)).padStart(2, '0');
    const sec = String(timeLeft % 60).padStart(2, '0');
    timerEl.textContent = `Time Left: ${min}:${sec}`;
    if (timeLeft <= 30) timerEl.classList.add("red");
    if (timeLeft <= 0) {
      clearInterval(timer);
      submitTest();
    }
  }, 1000);
}

function submitTest() {
  if (!confirm("Submit test?")) return;
  const correct = Object.values(saved).filter(x => x.correct).length;
  const total = questions.length;
  const percent = Math.round((correct / total) * 100);
  const weakAreas = questions.map((q, i) => (!saved[i]?.correct ? `Q${i + 1}` : null)).filter(x => x);

  buildTranscript(correct, total, percent, weakAreas);

  const message = `Score: ${correct}/${total} (${percent}%)\nWeak Areas: ${weakAreas.join(", ") || "None"}`;
  const text = encodeURIComponent(`Greetings from Heartique Nursing Nexus.\n\nCandidate: ${userName}\nReason: ${userReason}\n\n${message}`);
  const url = `https://wa.me/${userPhone}?text=${text}`;

  if (confirm("Note: This is only a preview. Proceed to WhatsApp?")) {
    window.open(url, "_blank");
  }

  clearInterval(timer);
}

function buildTranscript(score, total, percent, weakAreas) {
  const fullAnswers = questions.map((q, i) => {
    const user = saved[i]?.selected || "Not answered";
    const correct = q.answer;
    const isCorrect = user === correct;
    const style = isCorrect ? "" : "background: #ffdddd;";
    return `
      <div style="margin-bottom:20px; padding:10px; border:1px solid #ccc; ${style}">
        <p><strong>Q${i + 1}:</strong> ${q.question}</p>
        <p><strong>Your Answer:</strong> ${user}</p>
        <p><strong>Correct Answer:</strong> ${correct}</p>
      </div>
    `;
  }).join("");

  const html = `
    <h2 style="color:#002147;">Heartique Nursing Nexus</h2>
    <h4>NCK Simulation Transcript</h4><hr>
    <p><strong>Name:</strong> ${userName}</p>
    <p><strong>Phone:</strong> ${userPhone}</p>
    <p><strong>Reason:</strong> ${userReason}</p>
    <p><strong>Score:</strong> ${score}/${total}</p>
    <p><strong>Percentage:</strong> ${percent}%</p>
    <p><strong>Weak Areas:</strong> ${weakAreas.join(", ") || "None"}</p><br>
    <h3>ðŸ“– Full Review</h3>${fullAnswers}
  `;
  document.getElementById("transcriptContent").innerHTML = html;
  document.getElementById("transcript").style.display = "block";
  document.querySelector(".tab-bar").style.display = "none";
  document.querySelector(".container").style.display = "none";
  document.getElementById("timer").style.display = "none";
  document.querySelector("footer").style.display = "none";
}
</script>
</body>
</html>
